<ion-header class="ion-no-border" [translucent]="true" mode="md">
	<ion-toolbar color="light">
		<ion-row>
			<ion-buttons>
				<ion-button color="dark" slot="icon-only" (click)="dismiss()">
					<ion-icon name="arrow-back-outline"></ion-icon>
				</ion-button>
			</ion-buttons>
			<ion-title>
				<!-- {{data.post.headerText}} -->
				Post
			</ion-title>
		</ion-row>
	</ion-toolbar>
</ion-header>

<ion-content fullscreen='true' *ngIf="isLoaded" (swipeleft)="swipeToNextPost($event)" (swiperight)="swipeToPreviousPost($event)">
	<ion-img style="z-index: -1" class='post-image' [src]='post.media.standard_resolution.url'></ion-img>
	<div class="post-content">
		  <ion-card-content>
				<ion-note class="padding-top">{{post.created_datetime | date:'medium':'+0530'}}</ion-note>
				<b>
					<h2 class="padding-top">{{post.title}}</h2>
				</b>
				<h2 class="padding-top">{{post.subtitle}}</h2>
				<ion-row class="padding-top right">
					<ion-note *ngIf="post.views?post.views.length>0:false" class="icons">{{post.views.length}} <ion-icon color="medium" name="eye-outline"></ion-icon></ion-note>
					<ion-note *ngIf="post.rating?post.rating.length>0:false" class="icons">{{post.rating.length}} <ion-icon color="danger" name="heart"></ion-icon></ion-note>
					<ion-note *ngIf="post.comment?post.comment.length>0:false" class="icons">{{commentRepo.length}} <ion-icon color="medium" name="chatbubbles"></ion-icon></ion-note>
				</ion-row>
				<ion-row class="padding-top">
					<ion-note size='12' *ngIf="data.post.userid!=userService.currentUserId">By <b>{{post.user.full_name}}</b></ion-note>
				</ion-row>
		  	<p *ngIf="!post.isQuill">{{post.description.content}}</p>
				<div class="padding-top" *ngIf="post.isQuill" [innerHTML]="post.description.quillContent"></div>
		  </ion-card-content>

			<div lines="none" class="text-small">
				<ion-chip>
				  <ion-label>{{(post.category!="")?post.category:'general'}}</ion-label>
				</ion-chip>
				<ion-chip  *ngFor="let tag of post.tags">
				  <ion-label>{{tag}}</ion-label>
				</ion-chip>
			</div>

		<ion-toolbar>
			<ion-buttons slot="end">
				<ion-button [disabled]="util.timer>0" color="light" (click)="toggleCommentBox()">
					<ion-icon *ngIf="util.timer<=0" color="dark" [name]="commentBoxToggleIcon"></ion-icon>
					<!-- <ion-badge *ngIf='commentRepo.length>0' color="clear">{{commentRepo.length}}</ion-badge> -->
					<ion-label *ngIf="util.timer>0">{{util.timer}}</ion-label>
				</ion-button>
			</ion-buttons>
		</ion-toolbar>

		<div class="comment" *ngIf="commentRepo.length>0">
			<ion-item lines="none">
				<ion-label>See what people think about this!</ion-label>
			</ion-item>
			<ion-item lines="none" *ngFor="let comment of commentList" (press)="dropDownOptions(comment.comment_id,comment.post_id,comment.userid,$event)">
				<ion-row>
		      <ion-col size="12">
						<ion-chip color="clear">
						  <ion-avatar>
						    <img [src]="comment.user.profile_picture?comment.user.profile_picture:userService.dummyimage">
						  </ion-avatar>
							<!-- <ion-label>{{userService.me.full_name}}</ion-label> -->
						</ion-chip>
						<ion-note><b>{{comment.user.full_name}}</b> says, <br/>"{{comment.text}}"</ion-note>
		      </ion-col>
		      <!-- <ion-col size="2">
		        <ion-button shape="round" color="light" size="small" fill="clear"><ion-icon slot="end" name="caret-up-circle-outline"></ion-icon></ion-button>
		        <ion-button shape="round" color="light" size="small" fill="clear" align="center"><b>{{line.votes.up-line.votes.down}}</b></ion-button>
		        <ion-button shape="round" color="light" size="small" fill="clear"><ion-icon slot="end" name="caret-down-circle-outline"></ion-icon></ion-button>
		      </ion-col> -->
		    </ion-row>
			</ion-item>
			<ion-infinite-scroll threshold="100px" (ionInfinite)="loadMoreComments($event)">
		    <ion-infinite-scroll-content
		      loadingSpinner="bubbles"
		      loadingText="Loading comments...">
		    </ion-infinite-scroll-content>
		  </ion-infinite-scroll>
		</div>
	</div>

	<!-- <ion-fab style="margin: 0 0 0 0;" vertical="bottom" horizontal="end" slot="fixed">
		<ion-fab-button [disabled]="util.timer>0" color="light" (click)="toggleCommentBox()">
			<ion-icon *ngIf="util.timer<=0" color="dark" [name]="commentBoxToggleIcon"></ion-icon>
			<ion-badge *ngIf='commentRepo.length>0' color="clear">{{commentRepo.length}}</ion-badge>
			<ion-label *ngIf="util.timer>0">{{util.timer}}</ion-label>
		</ion-fab-button>
	</ion-fab> -->


</ion-content>
<ion-footer>
	<ion-item *ngIf="isLoaded&&!isCommentBoxOpen&&post.user.userid!=userService.currentUserId">
			<ion-col *ngFor="let i of [1,2,3,4,5]">
				<ion-buttons>
					<ion-button (click)="ratePost(i)" color="clear">
						<ion-icon color="danger" [name]="(myRating>=i)?'heart':'heart-outline'"></ion-icon>
					</ion-button>
				</ion-buttons>
			</ion-col>
	</ion-item>
	<ion-item lines="none" *ngIf="isLoaded&&isCommentBoxOpen">
		<ion-col size="10">
			<ion-textarea class="inputField" rows='2' [value]='commentText' (ionInput)="updateNextLine($event)" type='text' align="left" placeholder="What do you think about this?"></ion-textarea>
		</ion-col>
		<ion-col size="2">
			<ion-button (click)="setPrivateFlag()" [disabled]="data.post.userid==userService.currentUserId" size="large" fill="clear" class="brandRed">
				<ion-icon [name]="privateFlagStatus"></ion-icon>
			</ion-button>
			<ion-button (click)='addNewComment(commentText)' [disabled]="commentText.length<=4" size="large" fill="clear" class="brandRed">
				<ion-icon slot="end" name="arrow-forward-circle-outline"></ion-icon>
			</ion-button>
		</ion-col>
	</ion-item>
	<ion-toolbar *ngIf="isLoaded&&post.userid==userService.currentUserId">
		<ion-buttons slot="end">
			<ion-button color="danger" slot="end" (click)='deletePost(data.post.post_id)'>
				<ion-icon name="trash-outline"></ion-icon>
			</ion-button>
			<!-- <ion-button color="dark" slot="end" (click)='editPost(data)'>
				<ion-icon name="create-outline"></ion-icon>
			</ion-button> -->
		</ion-buttons>
	</ion-toolbar>
	<!-- <ion-col *ngIf="data.post.userid!=userService.currentUserId&&post.rating.length<=0">
		<ion-button *ngFor="let i of [1,2,3,4,5]" shape="circle" color="clear" (click)="ratePost(i)">
			<ion-icon slot="end" color="danger" [name]="(myRating>=i)?'heart':'heart-outline'"></ion-icon>
		</ion-button>
	</ion-col> -->
</ion-footer>
